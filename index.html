<!doctype html>
<html lang="en">
  <head>
    <title>EchoPlay Experiments!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="css/echoplay.css"/>
    <script>
      function isElectron() {
        return (typeof process !== "undefined") && process.versions && (process.versions.electron !== undefined)
      }
      function isMobile(){
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
      }

      if (isElectron()){
        window.$ = window.jQuery = require('jquery');
      }
    </script>
  </head>
  <body>
    <script src="js/jquery/jquery.min.js"></script>
    <script src="js/pep/pep.min.js"></script>

    <div id="main">
      <div id="header">
        <div id="code"><canvas id="qrcode"></canvas></div>
        <div id="jam">
          <p>join the jam @</p>
          <p><strong id="url"></strong></p>
        </div>
        <div id="app-title">
          <h1>echo<strong>play</strong></h1>
        </div>
      </div>
      <div id="interface">
      </div>
    </div>

    <script>
    $.getMultiScripts = function(arr, path) {
        var _arr = $.map(arr, function(scr) {
            return $.getScript( (path||"") + scr );
        });

        _arr.push($.Deferred(function( deferred ){
            $( deferred.resolve );
        }));

        return $.when.apply($, _arr);
    }

    var Tone, echoplay
    $(window).on("load", function() {
      let vendorScripts = [
        'js/mousetrap/mousetrap.min.js',
        'js/mousetrap/plugins/bind-dictionary/mousetrap-bind-dictionary.min.js',
        'socket.io/socket.io.js',
        'js/qrcode/qrcode.min.js',
        'js/vendor/startaudiocontext.js',
      ]
      let scripts = [
        'js/mobile.js',
        'js/note.js',
        'js/instrument.js',
        'js/interface.js',
        'js/echoplay.js',
        'js/midi.js'
      ]

      $.getMultiScripts(vendorScripts).done(function() {
        console.log("loaded vendor scripts")
        if (isElectron() == true) Tone = require("tone");
        else $.getScript("js/tone/Tone.min.js")
        $.getMultiScripts(scripts).done(function() { console.log("echoplay ready to jam") })
       })
    })
    </script>

  </body>
</html>
