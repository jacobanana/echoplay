"use strict";var AudioContextStarted=!1;$(document).ready(function(){isMobile()&&(StartAudioContext(Tone.context,$("body"),function(){}),document.ontouchmove=function(t){t.preventDefault()})});
"use strict";Array.prototype.rotate=function(t){for(;t--;){var e=this.shift();this.push(e)}return this},Array.prototype.remove=function(t){var e=this.indexOf(t);return this.splice(e,1),this},Array.prototype.last=function(){return this[this.length-1]};var NOTE_NAMES="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),NOTES=NOTE_NAMES.filter(function(t){return!t.includes("#")&&!t.includes("b")}),SHARPS=NOTE_NAMES.filter(function(t){return t.includes("#")||!t.includes("b")}),FLATS=NOTE_NAMES.filter(function(t){return t.includes("b")||!t.includes("#")});function NoteTokenize(t){if("string"!=typeof t)return null;var e=/\b([A-G]|[a-g])(#|b|)([0-9]|10|11|)\b/g.exec(t);if(e){var n=e[1]+e[2],i=parseInt(e[3]);return isNaN(i)&&(i=null),[n,i]}return null}function NoteInterval(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"C",n=void 0;return n=SHARPS.includes(e)?SHARPS.indexOf(e):FLATS.includes(e)?FLATS.indexOf(e):0,SHARPS.includes(t)?SHARPS.rotate(n).indexOf(t):FLATS.includes(t)?FLATS.rotate(n).indexOf(t):(console.log(t,n),null)}function NoteToMidi(t){if("string"==typeof t){var e=NoteTokenize(t);return null===e?null:12*(e[1]+1)+NoteInterval(e[0])-24}if("number"==typeof t)return t}function NoteFromMidi(t){if("number"==typeof t)return SHARPS[t%12]+(parseInt(t/12)+1).toString()}function NoteFreq(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:440,n=void 0;if("string"==typeof t){if(null===(n=NoteToMidi(t)))return null}else{if("number"!=typeof t)return null;n=t}return+(e/32*Math.pow(2,(n-9)/12)).toFixed(2)}function NoteIntervalToName(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"C",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#",i=NoteInterval(e);function r(t){var e=(t+i)%12;return"#"==n?SHARPS[e]:FLATS[e]}switch(t.constructor){case Number:return r(t);case Array:return t.map(function(t){return r(t)});default:return null}}var SCALES=new Object;function buildScale(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=SCALES[t].definition.slice(),i=new Array,r=new Array,o=(n.length+SCALES[t].rootRepeat)*e;1==SCALES[t].rootRepeat&&(n.push(12),r.push(n.length));for(var u=0;u<o;u++)i.push(n[u%n.length]+12*parseInt(u/n.length));return{name:t,definition:n,intervals:i,repeat:r}}SCALES.major={definition:[0,2,4,5,7,9,11],rootRepeat:!0},SCALES.minor={definition:[0,2,3,5,7,8,10],rootRepeat:!0},SCALES.minor_harmonic={definition:[0,2,3,5,7,8,11],rootRepeat:!0},SCALES.gipsy={definition:[0,2,3,6,7,8,11],rootRepeat:!0},SCALES.pentatonic={definition:[0,2,5,7,9],rootRepeat:!1},SCALES.minor_melodic_asc={definition:[0,2,3,5,7,9,11],rootRepeat:!0},SCALES.minor_melodic_desc={definition:[0,2,3,5,7,8,10],rootRepeat:!0},SCALES.octatonic={definition:[0,1,3,4,6,7,9,10],rootRepeat:!1},SCALES.chromatic={definition:[0,1,2,3,4,5,6,7,8,9,10,11],rootRepeat:!1};
"use strict";var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Instrument=function(){function Instrument(t,e,i){_classCallCheck(this,Instrument),this.local=i||!1,this.socket=e,this.triggeredNotes=new Array,t&&this.loadPreset(t)}return _createClass(Instrument,[{key:"loadPreset",value:function loadPreset(presetName){var _this=this;this.name=presetName,this.filePath="instruments/"+presetName+".json",$.getJSON(this.filePath,function(data){_this.instance=eval(data.instance),_this.polyphony=data.polyphony,1==_this.polyphony?_this.monophonic=!0:_this.monophonic=!1,_this.options=data.options}).then(function(){1==_this.monophonic?_this.inst=new _this.instance(_this.options):(_this.inst=new Tone.PolySynth(_this.polyphony,_this.instance),_this.inst.set(_this.options)),_this.inst.toMaster()})}},{key:"triggerAttack",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;this.inst&&(1==this.polyphony?(this.triggeredNotes.length>0||!0===e)&&(this.inst.triggerAttack(t,null,s),-1==this.triggeredNotes.indexOf(t)&&0==i&&this.triggeredNotes.push(t),!0===this.local&&this.socket.emit("note_on",t)):(!0===e||!0===i&&this.triggeredNotes.length>0)&&(!0!==i&&this.triggeredNotes.push(t),this.inst.triggerAttack(t,null,s),!0===this.local&&this.socket.emit("note_on",t)))}},{key:"triggerRelease",value:function(t){this.inst&&(1==this.monophonic?(this.triggeredNotes.remove(t),0==this.triggeredNotes.length?this.inst.triggerRelease():this.triggerAttack(this.triggeredNotes.last())):(this.triggeredNotes.length>0&&this.triggeredNotes.remove(t),this.inst.triggerRelease(t)),!0===this.local&&this.socket.emit("note_off",t))}},{key:"releaseAll",value:function(){this.inst&&(1==this.monophonic?this.inst.triggerRelease():this.inst.releaseAll(),this.triggeredNotes.length=0,!0===this.local&&this.socket.emit("release_all"))}},{key:"noteLeave",value:function(t){this.inst&&(0==this.monophonic&&this.inst.triggerRelease(t),!0===this.local&&this.socket.emit("note_off",t))}},{key:"setVolume",value:function(t){"number"!=typeof t||t>0||(this.inst.volume.value=t)}},{key:"volumeUp",value:function(){this.setVolume(this.inst.volume.value+1)}},{key:"volumeDown",value:function(){this.setVolume(this.inst.volume.value-1)}}]),Instrument}();
"use strict";var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Interface=function(){function e(t,n,o){_classCallCheck(this,e),this.socket=n,this.id="#"+n.id,this.players=o,this.instrument=this.players[n.id].instrument,this.parent=t||"#interface",this.setPalette(.5,128,127,12,40)}return _createClass(e,[{key:"buildAndBindAll",value:function(){this.build(),this.bindMouseAndTouch(),this.bindKeyboard()}},{key:"setPalette",value:function(e,t,n,o,r){r=r||20,this.colorPaletteOn=makeColorPalette(e,t,n,o),this.colorPaletteOff=makeColorPalette(e,t+r,n-r,o)}},{key:"setupJam",value:function(e){this.jam=e,this.scale=buildScale(this.jam.global.scale,this.jam.local.octaveRange),this.buildAndBindAll()}},{key:"noteOn",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;try{(1==this.instrument.polyphony||this.instrument.triggeredNotes.length<this.instrument.polyphony)&&((this.instrument.triggeredNotes.length>0||!0===t)&&$(this.id+" [note='"+e+"']").css("background-color",this.colorPaletteOn[NoteInterval(e.replace(/\d+/g,""))]),this.instrument.triggerAttack(e,t,n,o))}catch(e){console.log(e)}}},{key:"noteOff",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{(this.instrument.triggeredNotes.length>0||1==t)&&this.instrument.triggerRelease(e)}catch(e){console.log(e)}$(this.id+" [note='"+e+"']").css("background-color",this.colorPaletteOff[NoteInterval(e.replace(/\d+/g,""))])}},{key:"noteLeave",value:function(e){try{this.instrument.noteLeave(e)}catch(e){console.log(e)}}},{key:"bindMouseAndTouch",value:function(){var e=this;$(this.id+" [trigger=true]").on("pointerdown",function(t){e.noteOn($(t.currentTarget).attr("note"))}),$(this.id+" [trigger=true]").on("pointerup",function(t){e.noteOff($(t.currentTarget).attr("note"))}),$(this.id+" [trigger=true]").on("pointerenter",function(t){e.noteOn($(t.currentTarget).attr("note"),!1,!0)}),$(this.id+" [trigger=true]").on("pointerleave",function(t){var n=$(t.currentTarget).attr("note");e.noteLeave(n),$(e.id+" [note='"+n+"']").css("background-color",e.colorPaletteOff[NoteInterval(n.replace(/\d+/g,""))])}),$("#header").on("pointerup",function(){e.instrument.releaseAll()})}},{key:"bindSockets",value:function(){var e=this;this.socket.on("note_on",function(t){$(e.id+" [note='"+t.note+"'] > [client_id="+t.id+"]").addClass("o-1");try{1==e.players[t.id].play&&e.players[t.id].instrument&&e.players[t.id].instrument.triggerAttack(t.note,!0,!1)}catch(e){console.log(e)}}),this.socket.on("note_off",function(t){$(e.id+" [note='"+t.note+"'] > [client_id="+t.id+"]").removeClass("o-1");try{e.players[t.id].play&&e.players[t.id].instrument&&e.players[t.id].instrument.triggerRelease(t.note)}catch(e){console.log(e)}}),this.socket.on("release_all",function(t){$(e.id+" [trigger=true] > [client_id="+t.id+"]").removeClass("o-1")}),this.socket.on("disconnect",function(){e.removeAllPlayers(),alert("Server disconnected... you are now playing by yourself")})}}]),e}(),PadsInterface=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,Interface),_createClass(t,[{key:"build",value:function(){var e=this;$(this.parent).html($("<div/>").addClass("block").attr({id:this.socket.id})),this.scale.intervals.forEach(function(t,n){var o=e.jam.local.rootOctave+parseInt((t+NoteInterval(e.jam.global.rootNote))/12),r=(t+NoteInterval(e.jam.global.rootNote))%12,i=NoteIntervalToName(t,e.jam.global.rootNote)+o;$(e.id).append($("<div/>").addClass("pad"+(-1!=e.scale.repeat.indexOf(n)||e.scale.intervals.indexOf(t)==e.scale.intervals.length-1?" repeat":"")).css("background-color",e.colorPaletteOff[r]).attr({note:i,trigger:!0,"touch-action":"none"}).html($("<div/>").text(e.jam.global.showNotes?i:"").addClass("pad-note")))}),Object.keys(this.players).forEach(function(t){$(e.id+" [trigger=true]").append($("<div/>").attr({client_id:t}).addClass("mini-pad"))})}},{key:"addPlayer",value:function(e){$(this.id+" [trigger=true]").append($("<div/>").attr({client_id:e}).addClass("mini-pad"))}},{key:"removePlayer",value:function(e){$(this.id+" [client_id="+e+"]").remove()}},{key:"removeAllPlayers",value:function(){console.log("remove all players.."),$(this.id+" .mini-pad").remove()}},{key:"unbindKeyboard",value:function(){KEYS_PAD.forEach(function(e){Mousetrap.unbind(e,"keydown"),Mousetrap.unbind(e,"keyup")})}},{key:"bindKeyboard",value:function(){var e=this;this.unbindKeyboard(),$(this.id+" [trigger=true]").each(function(t,n){Mousetrap.bind(KEYS_PAD[t],function(t){0!=t.repeat&&void 0!==t.repeat||e.noteOn($(n).attr("note"))},"keydown"),Mousetrap.bind(KEYS_PAD[t],function(){e.noteOff($(n).attr("note"))},"keyup")}),Object.keys(ACCESSIBLE_KEYS).forEach(function(e){Mousetrap.bind(e,function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,0==t.repeat&&Mousetrap.trigger(ACCESSIBLE_KEYS[e],"keydown")},"keydown"),Mousetrap.bind(e,function(){Mousetrap.trigger(ACCESSIBLE_KEYS[e],"keyup")},"keyup")})}}]),t}();
"use strict";var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,o,a){return o&&e(t.prototype,o),a&&e(t,a),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function makeColorPalette(e,t,o,a){function l(e){var t="0123456789ABCDEF";return String(t.substr(e>>4&15,1))+t.substr(15&e,1)}e=e||.52,t=t||128,o=o||127,a=a||12;for(var n,c,s=new Array,i=0;i<a;++i){var r=Math.sin(e*i+0)*o+t,h=Math.sin(e*i+2)*o+t,u=Math.sin(e*i+4)*o+t;s.push((n=h,c=u,"#"+l(r)+l(n)+l(c)))}return s}if(isElectron()){var _require=require("electron"),remote=_require.remote;Mousetrap.bind("f12",function(){remote.getCurrentWindow().toggleDevTools()})}function toggleFullScreen(){var e=window.document,t=e.documentElement,o=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,a=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?a.call(e):o.call(t)}var KEYS_PAD=["z","x","c","v","b","n","m",",","a","s","d","f","g","h","j","k","w","e","r","t","y","u","i","o","2","3","4","5","6","7","8","9"],ACCESSIBLE_KEYS={space:"a",enter:"d",tab:"g","shift+tab":"j",backspace:"k"},INSTRUMENTS={"Polyphonic Sine":"poly_sine"},EchoPlay=function(){function e(t){var o=this;_classCallCheck(this,e),this.socket=io.connect(),this.parent=t||"#interface",this.jam={local:{maestro:!0,rootOctave:3,octaveRange:2,instrumentPreset:Object.values(INSTRUMENTS)[Math.floor(Math.random()*Object.values(INSTRUMENTS).length)]},global:{rootNote:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][Math.floor(12*Math.random())],scale:["major","minor","minor_harmonic","gipsy"][Math.floor(4*Math.random())],showNotes:!0}},this.players=new Object,this.socket.on("connect",function(){o.socket.emit("instrument_preset",o.jam.local.instrumentPreset),o.addPlayer(o.socket.id,o.socket,!0,o.jam.local.instrumentPreset),o.interface=new PadsInterface(o.parent,o.socket,o.players),o.setupSocket(),o.socket.emit("get_players")}),this.displaySettings=!1}return _createClass(e,[{key:"setupSocket",value:function(){var e=this;this.socket.on("url",function(e){QRCode.toCanvas(document.getElementById("qrcode"),e,{scale:2,color:{light:"#000000ff",dark:"#ffffffff"}},function(t){t&&console.error(t),$("#url").text(e)})}),this.socket.on("new_jam",function(t){e.jam.global=t,e.render()}),this.socket.on("share_locals",function(t){e.jam.local=t,e.render()}),this.socket.on("players",function(t,o){console.log("players received"),console.log(o),t.forEach(function(t){console.log("player:",t,o[t]),-1==Object.keys(e.players).indexOf(t)&&e.addPlayer(t,e.socket,!1,o[t])}),1==e.displaySettings&&e.renderSettings()}),this.socket.on("add_player",function(t,o){console.log("add player:",t,o),e.addPlayer(t,e.socket,!1,o),1==e.displaySettings&&e.renderSettings()}),this.socket.on("remove_player",function(t){console.log("remove player:",t),e.removePlayer(t),1==e.displaySettings&&e.renderSettings()}),this.socket.on("load_instrument",function(t,o){console.log("load_instrument",t,o,t==e.socket.id),e.players[t]&&(console.log("loading preset"),e.players[t].instrument.loadPreset(o))}),this.socket.emit("request_jam"),this.interface.bindSockets()}},{key:"toggleSettings",value:function(){this.displaySettings=!this.displaySettings,this.render()}},{key:"renderSettings",value:function(){var e=this;$(this.parent).html("<div id='settings'>       <h1>Settings</h1>       <h2>Jammers</h2>       <div id='jammers'/>       <h2>We're jamming in:</h2>       <p>"+this.jam.global.rootNote+" "+this.jam.global.scale+"</p>     </div>"),Object.keys(this.players).forEach(function(t){$("#jammers").append($("<div/>").attr({player_id:t}).click(function(o){e.players[t].play=!e.players[t].play,1==e.players[t].play?$(o.target).css("color","#00FF00"):$(o.target).css("color","#FF0000")}).text(t+" / "+e.players[t].instrument.name+" / "+e.players[t].play))})}},{key:"render",value:function(){1==this.displaySettings?this.renderSettings():this.interface.setupJam(this.jam)}},{key:"setRootOctave",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.jam.local.rootOctave=e,this.render(),!0===t&&!0===this.jam.local.maestro&&this.socket.emit("share_locals",this.jam.local)}},{key:"setOctaveRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"number"==typeof e&&(e<1?e=1:e>10&&(e=10),this.jam.local.octaveRange=e,this.render(),!0===t&&!0===this.jam.local.maestro&&this.socket.emit("share_locals",this.jam.local))}},{key:"setRootNote",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];-1!=NOTE_NAMES.indexOf(e)&&!0===this.jam.local.maestro&&(this.jam.global.rootNote=e,this.socket.emit("update_jam",this.jam.global))}},{key:"setScale",value:function(e){-1!=Object.keys(SCALES).indexOf(e)&&!0===this.jam.local.maestro&&(this.jam.global.scale=e,this.socket.emit("update_jam",this.jam.global))}},{key:"addPlayer",value:function(e,t,o,a){t=self.socket||t,o=o||!1,this.players[e]={instrument:new Instrument(a,t,o),play:!0},!1===o&&this.interface.addPlayer(e)}},{key:"removePlayer",value:function(e){this.interface.removePlayer(e);try{this.players[e].instrument.inst.dispose(),console.log("disposed of instrument "+e)}catch(e){console.log(e)}delete this.players[e]}}]),e}();$(document).ready(function(){Tone.context.latencyHint="fastest",echoplay=new EchoPlay;var e={"alt+a":function(){echoplay.setRootNote("A")},"alt+b":function(){echoplay.setRootNote("B")},"alt+c":function(){echoplay.setRootNote("C")},"alt+d":function(){echoplay.setRootNote("D")},"alt+e":function(){echoplay.setRootNote("E")},"alt+f":function(){echoplay.setRootNote("F")},"alt+g":function(){echoplay.setRootNote("G")},"alt+right":function(){"B"==echoplay.jam.global.rootNote&&echoplay.setRootOctave(echoplay.jam.local.rootOctave+1,!0),echoplay.setRootNote(SHARPS[(SHARPS.indexOf(echoplay.jam.global.rootNote)+1)%SHARPS.length])},"alt+left":function(){var e=void 0;"C"==echoplay.jam.global.rootNote?(echoplay.setRootOctave(echoplay.jam.local.rootOctave-1,!0),e="B"):e=SHARPS[(SHARPS.indexOf(echoplay.jam.global.rootNote)-1)%SHARPS.length],echoplay.setRootNote(e)},"alt+r k":function(){echoplay.setRootNote(SHARPS[Math.floor(12*Math.random())])},"alt+up":function(){echoplay.setRootOctave(echoplay.jam.local.rootOctave+1,!0)},"alt+down":function(){echoplay.setRootOctave(echoplay.jam.local.rootOctave-1,!0)},"alt+shift+up":function(){echoplay.setOctaveRange(echoplay.jam.local.octaveRange+1,!0)},"alt+shift+down":function(){echoplay.setOctaveRange(echoplay.jam.local.octaveRange-1,!0)},"alt+shift+right":function(){var e=Object.keys(SCALES)[(Object.keys(SCALES).indexOf(echoplay.jam.global.scale)+1)%Object.keys(SCALES).length];echoplay.setScale(e)},"alt+shift+left":function(){var e=Object.keys(SCALES),t=void 0;t=echoplay.jam.global.scale==e[0]?e[e.length-1]:e[(e.indexOf(echoplay.jam.global.scale)-1)%e.length],echoplay.setScale(t)},"alt+r s":function(){echoplay.setScale(Object.keys(SCALES)[Math.floor(Math.random()*Object.keys(SCALES).length)])},"alt+0":function(){echoplay.setScale("chromatic")},"alt+1":function(){echoplay.setScale("major")},"alt+2":function(){echoplay.setScale("minor")},"alt+3":function(){echoplay.setScale("minor_harmonic")},"alt+4":function(){echoplay.setScale("gipsy")},"alt+5":function(){echoplay.setScale("pentatonic")},"alt+6":function(){echoplay.setScale("minor_melodic_asc")},"alt+7":function(){echoplay.setScale("minor_melodic_desc")},"alt+8":function(){echoplay.setScale("octatonic")},"alt+n":function(){echoplay.jam.local.maestro&&echoplay.socket.emit("show_note_names",!0)},"alt+shift+n":function(){echoplay.jam.local.maestro&&echoplay.socket.emit("show_note_names",!1)}},t={"meta+up":function(){echoplay.setRootOctave(echoplay.jam.local.rootOctave+1)},"meta+down":function(){echoplay.setRootOctave(echoplay.jam.local.rootOctave-1)},"meta+shift+up":function(){echoplay.setOctaveRange(echoplay.jam.local.octaveRange+1)},"meta+shift+down":function(){echoplay.setOctaveRange(echoplay.jam.local.octaveRange-1)},"mod+.":function(){echoplay.interface.instrument.volumeUp()},"mod+,":function(){echoplay.interface.instrument.volumeDown()},f1:function(){toggleFullScreen()}};Mousetrap.bind(t),!0===echoplay.jam.local.maestro&&Mousetrap.bind(e),$("h1").click(function(){echoplay.toggleSettings()})});
"use strict";var midi=null,MIDIDevices=new Object;function onMIDISuccess(e){midi=e;var i=!0,a=!1,t=void 0;try{for(var n,o=midi.inputs[Symbol.iterator]();!(i=(n=o.next()).done);i=!0){var c=n.value[1];MIDIDevices[c.id]=c,MIDIDevices[c.id].onmidimessage=function(e){if(144==e.data[0]){var i=NoteFromMidi(e.data[1]),a=e.data[2]/127;console.log(i,a,e.data[2]),0==e.data[2]?echoplay.interface.noteOff(i,!0):echoplay.interface.noteOn(i,!0,!1,a)}}}}catch(e){a=!0,t=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw t}}}function onMIDIFailure(e){console.log("Failed to get MIDI access - "+e)}navigator.requestMIDIAccess().then(onMIDISuccess,onMIDIFailure);